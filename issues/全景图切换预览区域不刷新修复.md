# 全景图切换预览区域不刷新修复

## 问题描述
用户报告图像标注工具存在问题：切换全景图后，全景图预览区域（包括图像和文字）未刷新，但状态栏显示已切换，且右侧标注操作区域的导航控制和切片均已正确切换。

## 问题分析
通过代码分析发现根本原因：
1. **画布尺寸获取时机问题**：`canvas.winfo_width()`和`canvas.winfo_height()`可能在GUI布局未完成时返回0或1
2. **条件检查阻止绘制**：`if canvas_width > 1 and canvas_height > 1`会阻止图像绘制
3. **异常被静默处理**：宽泛的异常捕获可能掩盖了具体问题

## 解决方案
**方案1：添加画布尺寸检查和延迟重试机制**
- 在画布尺寸无效时，使用`after()`方法延迟100ms重试
- 添加详细的调试日志输出画布尺寸信息
- 限制重试次数避免无限循环

## 实施计划
1. 修改`load_panoramic_image`方法添加画布尺寸检查和重试机制
2. 改进异常处理，分别处理不同类型的错误
3. 添加辅助方法检查画布状态

## 执行状态
- [x] 问题分析完成
- [x] 解决方案确定
- [x] 实施计划制定
- [x] 代码修改完成
- [x] 调试日志添加完成
- [x] 强制刷新机制实现
- [ ] 用户测试验证
- [ ] 问题解决确认

## 代码修改详情

### 1. 修改load_panoramic_image方法
- 添加画布准备状态检查
- 实现延迟重试机制（最多5次，间隔100ms）
- 增强调试日志输出
- 添加画布尺寸无效时的默认尺寸fallback

### 2. 新增辅助方法
- `_is_canvas_ready()`: 检查画布是否准备就绪
- `_reset_panoramic_load_retry()`: 重置重试计数器

### 3. 改进异常处理
- 分别处理FileNotFoundError和PermissionError
- 保留通用异常处理作为fallback
- 所有异常都记录到调试日志

### 4. 添加调试日志到load_current_slice方法
- 记录文件加载状态和当前处理文件信息
- 追踪全景图ID变化情况（旧ID vs 新ID）
- 记录全景图是否改变的判断结果
- 追踪load_panoramic_image方法调用状态

### 5. 强制刷新机制
- 移除"仅在全景图改变时加载"的条件限制
- 强制每次切换都调用load_panoramic_image()方法
- 确保预览区域始终能够刷新

### 6. 修复log_debug方法缺失问题
- 在PanoramicAnnotationGUI类的__init__方法中绑定日志方法到实例
- 添加self.log_debug = log_debug等绑定
- 解决AttributeError: 'PanoramicAnnotationGUI' object has no attribute 'log_debug'错误

### 7. 修复SE1配置文件空格字符处理问题
- 修改config_file_service.py中的_parse_format_symbol_string方法
- 保持符号串原始格式，不去除空格字符
- 将空格字符映射为'invalid'状态
- 解决SE1配置文件前四个空格孔位被忽略的问题