# 数据集组织与标注规范

本文档提供了批量标注工具的数据集组织结构和标注规范指南，特别针对微生物药敏检测场景。

> **相关文档**:
> - [README.md](README.md) - 项目主要文档
> - [INSTALL.md](INSTALL.md) - 安装指南
> - [STARTUP_GUIDE.md](STARTUP_GUIDE.md) - 启动指南

## 1. 推荐的数据集组织结构

为了获得最佳的标注和训练效果，建议按照以下结构组织数据：

```
dataset/
├── bacteria/
│   ├── negative/
│   │   ├── clean/          # 无干扰
│   │   ├── with_pores/     # 含气孔
│   │   └── with_artifacts/ # 含杂质
│   ├── weak_growth/
│   │   ├── small_dots/              # 较小的点状弱生长
│   │   ├── light_gray_overall/      # 整体较淡的灰色弱生长
│   │   ├── irregular_light_areas/   # 不规则淡区域弱生长
│   │   └── dots_with_pores/         # 较小的点和气孔区域重叠
│   └── positive/
│       ├── clustered_clean/         # 聚集型生长（与气孔不重叠）
│       ├── clustered_with_pores/    # 聚集型生长（与气孔重叠）
│       ├── scattered/               # 分散型生长
│       └── heavy_growth/            # 重度生长
├── fungi/
│   ├── negative/
│   │   ├── clean/
│   │   ├── with_pores/
│   │   └── with_artifacts/
│   ├── weak_growth/
│   │   ├── small_dots/
│   │   ├── light_gray_overall/
│   │   ├── irregular_light_areas/
│   │   └── dots_with_pores/
│   └── positive/
│       ├── focal_clean/             # 聚焦性生长（与气孔不重叠）
│       ├── focal_with_pores/        # 聚焦性生长（与气孔重叠）
│       └── diffuse_growth/          # 弥漫性生长
├── metadata/
│   ├── annotations.json             # 详细标注信息
│   ├── batch_info.json              # 批次信息
│   └── quality_control.json         # 质量控制信息
└── splits/
    ├── train_files.txt              # 训练集文件列表
    ├── val_files.txt                # 验证集文件列表
    └── test_files.txt               # 测试集文件列表
```

## 2. 标注分类体系

### 2.1 主分类（3类）

1. **阴性（无生长）**
   - 孔内无明显微生物生长
   - 可能存在气孔、杂质等干扰因素

2. **弱生长**
   - 微生物生长迹象不明显
   - 需要结合梯度信息做二次判断
   - 通常表现为小黑点、淡灰色区域等

3. **阳性（明显生长）**
   - 明显的微生物生长
   - 细菌：黑色聚集、不规则黑色区域
   - 真菌：弥漫性点状生长、聚焦点状生长

### 2.2 辅助标签（可多选）

- **含气孔**：样本中存在覆膜激光打孔造成的气孔
- **含杂质**：样本中存在杂质干扰
- **边缘模糊**：样本边缘不清晰
- **真菌弥漫型**：真菌呈弥漫性生长
- **真菌聚集型**：真菌呈聚集型生长

## 3. 图像预处理建议

在标注前，建议对图像进行以下预处理：

1. **标准化**：归一化到[0,1]
2. **增强对比度**：使用CLAHE（限制对比度自适应直方图均衡）
3. **噪声抑制**：应用高斯滤波（轻度）
4. **边缘增强**：可选的Sobel/Canny边缘检测

## 4. 标注规范

### 4.1 基本规则

1. **一致性原则**：相似特征的样本应获得相同标注
2. **梯度原则**：考虑浓度梯度信息进行标注
3. **优先级原则**：生长 > 干扰因素（当二者同时存在时）

### 4.2 边界案例处理

1. **气孔边缘与弱生长重叠**：
   - 观察周围区域特征
   - 参考相邻浓度梯度
   - 标记为"弱生长"并添加"含气孔"辅助标签

2. **最低浓度弱生长**：
   - 根据业务规则，最低浓度的弱生长通常判为阳性
   - 标记为"弱生长"并在元数据中注明位置信息

3. **杂质干扰**：
   - 如果杂质明显影响判读，标记为"含杂质"
   - 记录在质量控制文件中，可能需要人工复核

### 4.3 质量控制

1. **交叉验证**：关键样本应由多人交叉标注
2. **一致性检查**：定期检查标注一致性
3. **专家审核**：疑难样本由领域专家最终审核
4. **梯度逻辑检查**：验证标注结果是否符合梯度逻辑

## 5. 数据划分策略

### 5.1 基于批次的分层划分

为避免数据泄露和确保模型泛化能力，建议采用基于批次的分层划分：

1. **批次隔离**：同一批次的样本不能同时出现在训练集和测试集中
2. **类别平衡**：每个集合中各类别样本比例保持一致
3. **质量优先**：高质量标注样本优先分配给测试集
4. **梯度完整性**：同一梯度序列的样本应在同一集合中

### 5.2 推荐划分比例

- 训练集：70%
- 验证集：15%
- 测试集：15%

## 6. 元数据记录

每个样本的标注应包含以下元数据：

```json
{
  "image_id": "sample_image.jpg",
  "microbe_type": "bacteria",  // 细菌或真菌
  "main_class": "weak_growth",  // 主分类
  "sub_class": "small_dots",  // 子分类
  "auxiliary_labels": ["with_pores"],  // 辅助标签
  "batch_id": "EB10000026",  // 批次ID
  "gradient_position": 3,  // 梯度位置
  "confidence": 0.95,  // 标注置信度
  "annotator_id": "user1",  // 标注者ID
  "annotation_time": "2023-08-24T14:30:00Z",  // 标注时间
  "is_verified": true,  // 是否经过验证
  "verification_notes": "Confirmed by expert"  // 验证备注
}
```

## 7. 使用批量标注工具

本项目提供的批量标注工具支持上述标注规范和数据组织结构：

1. **启动GUI工具**：
   ```bash
   # Windows
   start_gui.bat
   
   # Linux/Mac
   ./start_gui.sh
   ```

2. **批量导入**：使用GUI中的"批量导入"功能导入现有数据

3. **标注操作**：按照规范进行标注，可使用增强标注模式添加辅助标签

4. **导出数据**：使用"导出训练数据"功能导出为所需格式

5. **质量控制**：使用统计功能检查标注分布和一致性

## 8. 最佳实践

1. **定期备份**：定期备份标注数据
2. **版本控制**：对数据集和标注进行版本控制
3. **持续改进**：根据模型反馈持续优化标注规范
4. **文档更新**：及时更新标注指南和规范文档
5. **团队培训**：确保所有标注人员理解并遵循相同的规范

遵循这些数据组织和标注规范，将有助于提高标注质量和模型性能，特别是在处理复杂的微生物药敏检测场景时。