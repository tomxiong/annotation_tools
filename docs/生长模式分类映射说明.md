# 生长模式分类映射说明文档

## 文档目的
本文档为模型训练提供准确的生长模式分类标准和映射关系，确保AI模型能够正确识别和分类各种微生物生长模式。

## 最新分类标准（2025年9月更新）

### 1. 基本分类原则

#### 1.1 阴性/阳性二分法
- **阴性（Negative）**: 药物敏感，生长受抑制，临床判断为敏感
- **阳性（Positive）**: 药物耐药，生长明显，临床判断为耐药

#### 1.2 医学判断标准
分类基于临床意义而非生长强度，确保药敏检测的临床指导价值。

---

## 2. 详细分类映射

### 2.1 阴性模式（药物敏感）

| 模式名称 | 英文标识 | 生长特征 | 临床意义 | 训练标签 |
|---------|----------|----------|----------|----------|
| 清亮 | Clear | 完全抑制，无可见生长 | 高度敏感 | negative_clear |
| 微弱分散 | Weak_Scattered | 极少量散在生长点，明显受抑制 | 敏感 | negative_weak_scattered |
| 弱中心点 | Weak_Central | 仅中心区域有少量微弱生长点 | 敏感 | negative_weak_central |

### 2.2 阳性模式（药物耐药）

| 模式名称 | 英文标识 | 生长特征 | 临床意义 | 训练标签 |
|---------|----------|----------|----------|----------|
| 聚焦性 | Focused | 集中密集生长，形成聚焦病灶 | 耐药 | positive_focused |
| 强分散 | Strong_Scattered | 广泛分散的密集生长点 | 耐药 | positive_strong_scattered |
| 重度 | Heavy | 大面积密集生长，生长旺盛 | 高度耐药 | positive_heavy |
| 强中心点 | Strong_Central | 中心区域密集生长点，生长活跃 | 耐药 | positive_strong_central |
| 弱分散 | Weak_Scattered_Positive | 分散但可见的生长点，显示耐受性 | 耐药 | positive_weak_scattered |
| 不规则 | Irregular | 不规则形状的生长区域 | 耐药 | positive_irregular |

### 2.3 真菌专用模式

| 模式名称 | 英文标识 | 生长特征 | 临床意义 | 训练标签 |
|---------|----------|----------|----------|----------|
| 弥散 | Diffuse | 真菌呈弥散性生长 | 耐药（阳性） | fungi_positive_diffuse |
| 丝状非融合 | Filamentous_Non_Fused | 菌丝分离，生长受限 | 敏感（阴性） | fungi_negative_non_fused |
| 丝状融合 | Filamentous_Fused | 菌丝融合，生长旺盛 | 耐药（阳性） | fungi_positive_fused |

---

## 3. 重要映射变更记录

### 3.1 真菌分类修正（2025年9月）
- **丝状融合**: 从阴性改为阳性（菌丝融合表示生长旺盛）
- **丝状非融合**: 从阳性改为阴性（菌丝分离表示生长受限）

### 3.2 弱生长概念澄清
传统的"弱生长"已被细分为：
- **阴性+微弱分散**: 生长明显受药物抑制
- **阳性+弱分散**: 虽然弱但仍显示耐药性

---

## 4. 模型训练指导

### 4.1 数据标注标准
```python
# 标签映射示例
LABEL_MAPPING = {
    # 阴性模式
    "清亮": "negative_clear",
    "微弱分散": "negative_weak_scattered", 
    "弱中心点": "negative_weak_central",
    
    # 阳性模式
    "聚焦性": "positive_focused",
    "强分散": "positive_strong_scattered",
    "重度": "positive_heavy",
    "强中心点": "positive_strong_central",
    "弱分散": "positive_weak_scattered",
    "不规则": "positive_irregular",
    
    # 真菌模式
    "弥散": "fungi_positive_diffuse",
    "丝状非融合": "fungi_negative_non_fused",
    "丝状融合": "fungi_positive_fused"
}
```

### 4.2 关键判别特征

#### 4.2.1 颜色特征
- **阴性**: 颜色浅，透明度高，生长稀疏
- **阳性**: 颜色深，不透明，生长密集

#### 4.2.2 分布特征
- **中心点模式**: 主要在孔位中心区域
- **分散模式**: 分布在整个孔位区域
- **聚焦模式**: 形成明显的聚集区域

#### 4.2.3 密度特征
- **微弱**: 极少数生长点，几乎不可见
- **弱**: 少量生长点，但清晰可辨
- **强**: 大量密集生长点
- **重度**: 几乎覆盖整个区域

### 4.3 数据集构建建议

#### 4.3.1 样本平衡
- 确保阴性/阳性样本比例均衡
- 特别关注边界case的标注准确性
- 真菌样本单独构建数据集

#### 4.3.2 质量控制
- 多专家交叉验证标注结果
- 建立标注一致性检查机制
- 定期更新标注标准

---

## 5. 代码实现参考

### 5.1 验证函数
```python
def validate_growth_pattern_mapping(microbe_type, growth_level, pattern):
    """验证生长模式映射的正确性"""
    if microbe_type == "真菌":
        fungi_positive = ["弥散", "丝状融合"]
        fungi_negative = ["丝状非融合"]
        
        if pattern in fungi_positive:
            assert growth_level == "阳性", f"真菌{pattern}应为阳性"
        elif pattern in fungi_negative:
            assert growth_level == "阴性", f"真菌{pattern}应为阴性"
    
    else:  # 细菌
        positive_patterns = ["聚焦性", "强分散", "重度", "强中心点", "弱分散", "不规则"]
        negative_patterns = ["清亮", "微弱分散", "弱中心点"]
        
        if pattern in positive_patterns:
            assert growth_level == "阳性", f"细菌{pattern}应为阳性"
        elif pattern in negative_patterns:
            assert growth_level == "阴性", f"细菌{pattern}应为阴性"
```

### 5.2 数据预处理
```python
def preprocess_training_data(annotations):
    """预处理训练数据，统一标签格式"""
    processed_data = []
    
    for annotation in annotations:
        microbe_type = annotation.get('microbe_type')
        growth_level = annotation.get('growth_level') 
        pattern = annotation.get('pattern')
        
        # 生成统一的训练标签
        if microbe_type == "真菌":
            label_prefix = "fungi"
        else:
            label_prefix = "bacteria"
            
        level_prefix = "positive" if growth_level == "阳性" else "negative"
        pattern_suffix = pattern.lower().replace(" ", "_")
        
        final_label = f"{label_prefix}_{level_prefix}_{pattern_suffix}"
        
        processed_data.append({
            'image_path': annotation['image_path'],
            'bbox': annotation['bbox'],
            'label': final_label,
            'original_annotation': annotation
        })
    
    return processed_data
```

---

## 6. 注意事项

### 6.1 临床一致性
- 所有分类必须与临床药敏检测标准一致
- 优先考虑临床指导价值而非形态学特征
- 定期与临床专家验证分类准确性

### 6.2 模型训练要点
- 重点训练边界case的识别能力
- 建立robust的特征提取机制
- 考虑不同实验条件下的表现差异

### 6.3 持续更新
- 根据临床反馈调整分类标准
- 定期评估模型性能并优化
- 保持文档和代码的同步更新

---

## 版本信息
- **创建日期**: 2025年9月11日
- **版本**: v1.0
- **负责人**: 标注工具开发团队
- **审核人**: 临床微生物专家

## 更新历史
- **v1.0**: 初始版本，建立完整的分类映射体系
