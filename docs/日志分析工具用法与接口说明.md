# 日志分析工具用法与接口说明

## 一、日志分析器核心逻辑（LogAnalyzer）

### 1. 日志分类规则
- 按内容自动分类：如CONFIG、STRATEGY、PERFORMANCE、NAVIGATION、ANNOTATION、UI、MODEL、DEBUG、ERROR、WARNING、TIMING等。
- 支持自定义正则模式，自动识别日志类型。

### 2. 关键操作模式
- 识别如“保存并下一个”、“视图切换”、“CFG解析”、“模型预测”、“按钮时序”、“智能继承”等关键操作。

### 3. 主要接口
```python
class LogAnalyzer:
    def __init__(self, logs_dir: str = "logs"):
        # 初始化日志目录和分类规则
    def parse_log_line(self, line: str) -> Dict:
        # 解析单行日志，返回结构化信息
    def categorize_log(self, log_entry: Dict) -> Set[str]:
        # 对日志条目进行分类，返回分类集合
    def analyze_log_file(self, log_file: Path) -> Dict:
        # 分析单个日志文件，统计分类、级别、时间分布等
    def generate_category_files(self, analysis_result: Dict):
        # 按分类生成日志文件
    def generate_summary_report(self, analysis_results: List[Dict]):
        # 生成整体分析报告（Markdown）
```

### 4. 用法示例
```python
analyzer = LogAnalyzer(logs_dir="logs")
result = analyzer.analyze_log_file(Path("logs/annotation.log"))
analyzer.generate_category_files(result)
# 多文件分析
results = [analyzer.analyze_log_file(f) for f in Path("logs").glob("*.log")]
analyzer.generate_summary_report(results)
```

---

## 二、日志清理脚本核心逻辑（extract_key_logs）

### 1. 关键模式分类
- 智能继承策略、性能监控、模型视图、配置解析、错误和警告、视图切换等。
- 支持自定义正则，自动提取关键日志。

### 2. 主要接口
```python
def extract_key_logs():
    # 扫描logs目录下所有日志文件
    # 只处理最近3天的日志
    # 按关键模式分类，生成汇总文件
```

### 3. 用法示例
```python
extract_key_logs()  # 运行后在logs/cleanup_summary/生成分类汇总文件
```

---

## 三、业务接口保留建议
- 保留`LogAnalyzer`类定义及其主要方法接口，便于后续集成到业务代码。
- 清理脚本化分析和调试部分，只保留结构化分析能力。
- 日志清理脚本仅保留`extract_key_logs`函数定义和关键模式配置。

---

## 四、集成建议
- 推荐将日志分析和清理接口集成到业务模块（如日志管理、报表生成等），避免单独脚本化运行。
- 所有分析和清理逻辑建议通过统一的API调用，便于自动化和测试。

---

## 五、接口文档维护
- 本文档长期维护于`docs/日志分析工具用法与接口说明.md`，后续如有新分类或分析需求请补充。
